---
title: Spring boot P6Spy Log
date: 2025-06-03 14:03:00 +09:00
categories: [java,spring boot]
tags: [spring boot, java]
---

---

## Spring boot P6Spy Log 

---

Spring Boot ì— MyBatis ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  JPA ë¥¼ ì‚¬ìš© ì‹œ JPA ì¿¼ë¦¬ ë¡œê·¸ì—ì„œëŠ” íŒŒë¼ë¯¸í„°ì— ? ê°€ ë¶™ì–´ ìˆë‹¤ .  

ì¼ë‹¨ íšŒì‚¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ë¬¸ê³¼ ì†ŒìŠ¤ì½”ë“œëŠ” ê°€ì ¸ ì˜¬ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì˜ˆì‹œë¡œ ì‘ì„± í•´ë³¸ë‹¤.

```java
SELECT * FROM member WHERE id = ?
```

ë§Œì•½ JPA ë¡œ member ë¼ëŠ” Entity ì— id ë¡œ ì „ë¶€ ì¡°íšŒì‹œ idëŠ” ? ë¡œ ë³´ì¸ë‹¤. 

ì´ ?ëŠ” ì‹¤ì œ ê°’ì„ ë‚˜ì¤‘ì— ë°”ì¸ë”© í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ SQL ì„ ì‹¤í–‰ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ì´ë ‡ê²Œ JPA ê°€ ì‹¤í–‰ í•˜ëŠ” ì´ìœ ëŠ” ê°„ë‹¨í•˜ê²Œ 

1. ë³´ì•ˆ (SQL Injection ì„ ë°©ì§€)
2. ì„±ëŠ¥ (DB ê°€ ë¯¸ë¦¬ SQL ì¿¼ë¦¬ë¥¼ ì»´íŒŒì¼ í•˜ê³  ì¤€ë¹„ í•´ ë‘ì—ˆë‹¤ê°€ ê°™ì€ í˜•íƒœì— ì¿¼ë¦¬ê°€ ë°˜ë³µ ë  ê²½ìš° ë¹ ë¥´ê²Œ ì‹¤í–‰)
3. ì¬ì‚¬ìš© ë° íš¨ìœ¨ ( ì¿¼ë¦¬ íŒŒì‹± ë° ìµœì í™” ê³¼ì •ì´ ê°ì†Œ)

---

## ì ìš© ë°©ë²•

íšŒì‚¬ì—ì„œ ì‚¬ìš©í•œ ì‹¤ì œ ì½”ë“œê°€ ìˆë‹¤ë©´,,, ì‘ì„±í•˜ê¸° í¸í•˜ê² ì§€ë§Œ ì½”ë“œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ê¸° ë–„ë¬¸ì— ì ìš©í•œ ì½”ë“œì™€ ë¹„ìŠ·í•œ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•´ì„œ ì‘ì„± í•´ë³¸ë‹¤.

ì°¸ê³  ìë£Œ : [[SpringBoot] P6Spy query logging ì‚¬ìš©í•˜ê¸°](https://jong-bae.tistory.com/23)

ìœ„ ë¸”ë¡œê·¸ê°€ íšŒì‚¬ì—ì„œ ì ìš©í•œ P6Spy ë¡œê·¸ì™€ ê±°ì˜ ìœ ì‚¬í•˜ê¸° ë•Œë¬¸ì— ì„¤ëª…ì„ ì‘ì„±

1. ìš°ì„  í•„ìš”í•œ ì˜ì¡´ì„± (dependency)
    
    ```
    # Datasource ë°©ì‹ / URLì—°ê²° ë°©ì‹
    implementation 'p6spy:p6spy:3.9.1'
    
    # SpringBoot ìë™ì„¤ì • ë°©ì‹
    implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.8.1'
    ```
    

1. yml ì„¤ì •

```java
spring:
  datasource:
    driver-class-name: com.p6spy.engine.spy.P6SpyDriver
    url : jdbc:p6spy:oracle:thin:@localhost/
    username: 
    password: 
 
logging:
  level:
    p6spy: info
    
decorator:
  datasource:
    p6spy:
      enable-logging: true
```

2-1 [Spy.Properties](http://Spy.Properties) 

https://p6spy.readthedocs.io/en/latest/install.html

```java
# Spring Boot í™˜ê²½ì—ì„œ ê¶Œì¥ë˜ëŠ” ê¸°ë³¸ ì„¤ì • ì˜ˆì‹œ
appender=com.p6spy.engine.spy.appender.Slf4JLogger
logMessageFormat=com.p6spy.engine.spy.appender.MultiLineFormat
useLogPrefix=true
excludecategories=info,debug,result,batch
logfile=spy.log
```

properties ëŠ” ìƒë‹¹íˆ ë§ì€ ì˜µì…˜ì„ ê°€ì§€ê³  ìˆìœ¼ë©° ì„¤ì •ì€ ìœ„ ë§í¬ë¥¼ ì°¸ê³ í•˜ê³  ë§Œë“¤ë©´ ëœë‹¤.

1. Custom Format 
    
    ì¶œë ¥ ë˜ëŠ” ì¿¼ë¦¬ ë¡œê·¸ë¥¼ ì»¤ìŠ¤í…€ í•˜ëŠ” @Config ê°€ í•„ìš”í•˜ë‹¤.
    
    ```java
    @Configuration
    public class P6SpyFomatter implements MessageFormattingStrategy {
    
        @PostConstruct
        public void setLogMessageFormat() {
            P6SpyOptions.getActiveInstance().setLogMessageFormat(this.getClass().getName());
        }
    
        @Override
        public String formatMessage(int connectionId, String now, long elapsed, String category, String prepared, String sql, String url) {
            sql = formatSql(category, sql);
            return String.format("[%s] | %d ms | %s", category, elapsed, formatSql(category, sql));
        }
    
        private String formatSql(String category, String sql) {
            if (sql != null && !sql.trim().isEmpty() && Category.STATEMENT.getName().equals(category)) {
                String trimmedSQL = sql.trim().toLowerCase(Locale.ROOT);
                if (trimmedSQL.startsWith("create") || trimmedSQL.startsWith("alter") || trimmedSQL.startsWith("comment")) {
                    sql = FormatStyle.DDL.getFormatter().format(sql);
                } else {
                    sql = FormatStyle.BASIC.getFormatter().format(sql);
                }
                return sql;
            }
            return sql;
        }
    }
    ```
    

ì´ë ‡ê²Œ ì„¤ì •í•˜ê³  ì‹¤í–‰ ì‹œ SQL ì— ? ëŒ€ì‹  ì‚¬ìš©í•œ Valueê°€ ë°˜ì˜ ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

ë˜í•œ Spring 2.x ë²„ì „ê³¼ Spring 3.x ë²„ì „ì— ì‚¬ìš©ë²• ì°¨ì´ë„ ìˆë‹¤. 

---

ğŸ˜… **ì˜ëª» ì•Œë˜ ì§€ì‹** 

 

ì²˜ìŒ JPAë¥¼ ê³µë¶€ í•  ë•Œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ìš©í•˜ì—¬ JPAë¥¼ í˜¸ì¶œ í•œë‹¤. ê·¸ëŸ¬ê¸° ë•Œë¬¸ì— JPA ë¡œê·¸ì—ëŠ” (?) ê°€ ë¶™ëŠ” ë‹¤ê³  ìƒê° í•˜ê³  ìˆì—ˆë‹¤. 

í•˜ì§€ë§Œ,  P6Spy ë¥¼ ì°¾ì•„ë³´ë©´ì„œ (?) ê°€ ë¶™ëŠ” ì´ìœ ëŠ” í”„ë¡ì‹œ ê°ì²´ì™€ëŠ” ì „í˜€ ì—°ê´€ ì—†ëŠ” ë‹¤ë¥¸ ë‚´ìš©ì´ì—ˆë‹¤.  

JPAì— í”„ë¡ì‹œ ê°ì²´ëŠ” DBì— ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”© í•˜ì§€ ì•Šê³  Lazy ë¡œë”©ì„ í•˜ê¸° ìœ„í•¨ ì´ì˜€ê³  ,  ì‹¤ì œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ì‹œì ì— DBë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ì˜€ë‹¤. 

ë¬¼ìŒí‘œê°€ ì°íˆëŠ” ì´ìœ ëŠ” â†’ ë¯¸ë¦¬ ì¤€ë¹„ëœ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© 

í”„ë¡ì‹œ ê°ì²´ì˜ ìš©ë„ ì´ìœ ëŠ” â†’ Lazy ë¡œë”©ì„ ìœ„í•œ ëª©ì  ì´ì˜€ë‹¤.

ë˜í•œ,  

 

```java
SELECT member_0.id, member_0.name
FROM member member_0 
WHERE member_0.id = ?
```

ì´ëŸ°ì‹ìœ¼ë¡œ entity_0 , column_0 ì´ëŸ° ì‹ìœ¼ë¡œ ë¶™ëŠ” ê²ƒë„ Proxyê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ì¸ê°€?? ì˜€ë˜ ìƒê°ì„ ì°¾ì•„ë³´ë©´ì„œ ì˜ëª» ëœ ì§€ì‹ì´ì˜€ë˜ ê±¸ ì•Œê²Œ ë˜ì—ˆë‹¤.

ìœ„ .._0 ì€ ë‹¨ìˆœí•˜ê²Œ JPAì—ì„œ JPQL â†’ SQL ë¡œ ë°”ê¿€ë•Œ, ê¸°ê³„ì ìœ¼ë¡œ ë³„ì¹­ì„ ë‹¤ëŠ” ë¬¸ì œ ë•Œë¬¸ì´ ì—ˆë‹¤.